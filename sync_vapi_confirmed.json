{
    "name": "Sync Vapi Confirmed Data",
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "vapi-confirmed-data",
                "options": {}
            },
            "id": "vapi-webhook",
            "name": "Webhook",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                400,
                400
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "string": [
                        {
                            "value1": "={{ $json.body.message.type }}",
                            "value2": "tool-calls"
                        }
                    ]
                }
            },
            "id": "is-tool-call",
            "name": "Is Tool Call?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                600,
                400
            ]
        },
        {
            "parameters": {
                "jsCode": "const body = $input.first().json.body || $input.first().json;\n\n// Handle wrapped Vapi tool-calls\nif (body.message && body.message.toolCalls) {\n  const toolCall = body.message.toolCalls.find(tc => tc.function.name.includes('save_confirmed_data'));\n  if (toolCall) {\n    const args = typeof toolCall.function.arguments === 'string' ? JSON.parse(toolCall.function.arguments) : toolCall.function.arguments;\n    return {\n      dataFound: true,\n      name: args.name,\n      phone: args.phone,\n      email: args.email,\n      call_id: body.message.call.id\n    };\n  }\n}\n\n// Handle direct API Request payload (from the user's setup)\nif (body.name && body.call_id) {\n  return {\n    dataFound: true,\n    name: body.name,\n    phone: body.phone,\n    email: body.email,\n    call_id: body.call_id\n  };\n}\n\nreturn { dataFound: false };"
            },
            "id": "extract-data",
            "name": "Extract Data",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                800,
                380
            ]
        },
        {
            "parameters": {
                "authentication": "nocoDbApiToken",
                "operation": "create",
                "projectId": "p5xxqp29w9h8sb6",
                "table": "mtoilizta888pej",
                "dataToSend": "autoMapInputData",
                "options": {}
            },
            "id": "insert-confirmed",
            "name": "Insert Confirmed Table",
            "type": "n8n-nodes-base.nocoDb",
            "typeVersion": 3,
            "position": [
                1000,
                380
            ],
            "credentials": {
                "nocoDbApiToken": {
                    "id": "tV5VwP4BVmME7Vgo",
                    "name": "NocoDB Token"
                }
            }
        },
        {
            "parameters": {
                "authentication": "nocoDbApiToken",
                "operation": "update",
                "projectId": "p5xxqp29w9h8sb6",
                "table": "m013en5u2cyu30j",
                "dataToSend": "defineBelow",
                "fieldsToUpdate": {
                    "fields": [
                        {
                            "column": "is_confirmed",
                            "value": "true"
                        }
                    ]
                },
                "options": {
                    "where": "=(vapi_call_id,eq,{{ $node[\"extract-data\"].json.call_id }})"
                }
            },
            "id": "update-call-log",
            "name": "Mark Call as Confirmed",
            "type": "n8n-nodes-base.nocoDb",
            "typeVersion": 3,
            "position": [
                1200,
                380
            ],
            "credentials": {
                "nocoDbApiToken": {
                    "id": "tV5VwP4BVmME7Vgo",
                    "name": "NocoDB Token"
                }
            }
        }
    ],
    "connections": {
        "Webhook": {
            "main": [
                [
                    {
                        "node": "Is Tool Call?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Is Tool Call?": {
            "main": [
                [
                    {
                        "node": "Extract Data",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Extract Data": {
            "main": [
                [
                    {
                        "node": "Insert Confirmed Table",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Insert Confirmed Table": {
            "main": [
                [
                    {
                        "node": "Mark Call as Confirmed",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}