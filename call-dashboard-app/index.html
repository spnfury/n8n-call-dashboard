<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Llamadas - GeneralProtect</title>
    <link rel="stylesheet" href="./style.css">
    <!-- Extra Dependencies -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>

<body class="auth-hidden">
    <!-- Login Gate -->
    <div id="login-gate" class="login-overlay">
        <div class="login-card">
            <img src="./logo.png" alt="SkyPulse" class="brand-logo">
            <h2>Acceso al Dashboard</h2>
            <p>Introduce la contrase√±a para continuar</p>
            <form id="login-form">
                <input type="password" id="password-input" placeholder="Contrase√±a" required>
                <button type="submit" class="refresh-btn" style="width: 100%;">Entrar</button>
            </form>
            <p id="auth-error" class="auth-error" style="display: none;">Contrase√±a incorrecta</p>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="container" id="main-content">
        <header>
            <h1>
                <img src="./logo.png" alt="SkyPulse" class="header-logo">
                SkyPulse Dashboard <small
                    style="font-size: 12px; color: var(--text-secondary); margin-left: 8px; font-weight: 400;">v0.0.1</small>
            </h1>
            <div class="header-actions">
                <div class="automation-control">
                    <span style="font-size: 13px; font-weight: 600;">ü§ñ Automatizaci√≥n</span>
                    <label class="switch">
                        <input type="checkbox" id="automation-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <button class="refresh-btn" id="refresh-btn">üîÑ Actualizar</button>
            </div>
        </header>

        <nav class="nav-tabs">
            <div class="nav-tab active" data-tab="dashboard">üìä Dashboard</div>
            <div class="nav-tab" data-tab="leads">üë• Gesti√≥n de Leads</div>
            <div class="nav-tab" data-tab="scheduler">üìÖ Programar Llamadas</div>
            <div class="nav-tab" data-tab="realtime" id="nav-tab-realtime">üî¥ En Vivo <span id="realtime-badge"
                    class="realtime-badge" style="display:none;">0</span></div>
            <div class="nav-tab" data-tab="test">üß™ Test</div>
        </nav>

        <!-- Tab 1: Dashboard View -->
        <div id="view-dashboard" class="view-content active">

            <!-- Integrated Filter Bar -->
            <div class="dashboard-filter-bar">
                <div class="filter-bar-search">
                    <span class="filter-bar-icon">üîç</span>
                    <input type="text" id="filter-company" placeholder="Buscar por empresa...">
                </div>
                <div class="filter-bar-controls">
                    <div class="filter-pill">
                        <span class="filter-pill-icon">üö¶</span>
                        <select id="filter-status" class="filter-pill-select">
                            <option value="all">Todos</option>
                            <option value="success">√âxito</option>
                            <option value="fail">Fallidas</option>
                        </select>
                    </div>
                    <div class="filter-pill">
                        <span class="filter-pill-icon">üèÜ</span>
                        <select id="filter-score" class="filter-pill-select">
                            <option value="all">Score</option>
                            <option value="80-100">üü¢ 80-100</option>
                            <option value="60-79">üîµ 60-79</option>
                            <option value="40-59">üü° 40-59</option>
                            <option value="20-39">üü† 20-39</option>
                            <option value="0-19">üî¥ 0-19</option>
                        </select>
                    </div>
                    <div class="filter-pill date-pill">
                        <span class="filter-pill-icon">üìÖ</span>
                        <input type="text" id="date-range" placeholder="Fechas...">
                    </div>
                    <label class="filter-pill filter-pill-toggle" for="filter-confirmed">
                        <input type="checkbox" id="filter-confirmed">
                        <span class="filter-pill-check">‚úÖ Confirmados</span>
                    </label>
                </div>
            </div>

            <div class="analytics-section">
                <div class="section-title">üìä An√°lisis de Rendimiento</div>
                <div class="chart-container glass-effect">
                    <canvas id="callsChart"></canvas>
                </div>
            </div>

            <div class="planned-section" id="planned-section" style="display: none;">
                <div class="section-title">üìÖ Planificaci√≥n de Llamadas</div>
                <div class="planned-grid" id="planned-grid">
                    <!-- Upcoming leads will be injected here -->
                </div>
            </div>

            <div class="stats-grid" id="stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-calls">-</div>
                    <div class="stat-label">Total Llamadas</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-value" id="confirmed-count">0</div>
                    <div class="stat-label">Confirmados</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value" id="confirmation-rate">0%</div>
                    <div class="stat-label">% Confirmados</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value" id="success-rate">-</div>
                    <div class="stat-label">Tasa de √âxito</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avg-duration">-</div>
                    <div class="stat-label">Duraci√≥n Media</div>
                </div>
                <div class="stat-card score">
                    <div class="stat-value" id="avg-score">-</div>
                    <div class="stat-label" id="avg-score-label">Score Medio</div>
                </div>
            </div>

            <div class="section-title">üìã Historial de Llamadas</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Vapi Call ID</th>
                            <th>Empresa</th>
                            <th>Tel√©fono</th>
                            <th>Fecha</th>
                            <th>Resultado</th>
                            <th>Evaluaci√≥n</th>
                            <th>Duraci√≥n</th>
                            <th>Score</th>
                            <th>Notas</th>
                            <th>Confirmado</th>
                            <th>Detalle</th>
                        </tr>
                    </thead>
                    <tbody id="call-table">
                        <tr>
                            <td colspan="12" class="loading">Cargando datos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab 2: Lead Management View -->
        <div id="view-leads" class="view-content">
            <div class="leads-header">
                <div class="leads-search-container">
                    <input type="text" id="lead-search" class="leads-search-input"
                        placeholder="Buscar leads por nombre, email o tel√©fono...">
                </div>
                <div class="leads-actions">
                    <input type="file" id="csv-import" accept=".csv" style="display: none;">
                    <button class="btn-bulk-import" id="btn-import-csv">üìÇ Importar CSV</button>
                    <button class="btn-add-lead" id="btn-add-lead">‚ú® Nuevo Lead</button>
                </div>
            </div>

            <!-- KPI Header -->
            <div class="leads-kpi-section">
                <div class="leads-kpi-card leads-kpi-total">
                    <div class="leads-kpi-icon">üë•</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-total-leads">-</div>
                        <div class="leads-kpi-label">Total Leads</div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-nuevos">
                    <div class="leads-kpi-icon">üÜï</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-nuevos">-</div>
                        <div class="leads-kpi-label">Nuevos</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill nuevos" id="kpi-bar-nuevos"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-programados">
                    <div class="leads-kpi-icon">üìÖ</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-programados">-</div>
                        <div class="leads-kpi-label">Programados</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill programados" id="kpi-bar-programados"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-completados">
                    <div class="leads-kpi-icon">‚úÖ</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-completados">-</div>
                        <div class="leads-kpi-label">Completados</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill completados" id="kpi-bar-completados"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-interesados">
                    <div class="leads-kpi-icon">üî•</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-interesados">-</div>
                        <div class="leads-kpi-label">Interesados</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill interesados" id="kpi-bar-interesados"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-fallidos">
                    <div class="leads-kpi-icon">‚ùå</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-fallidos">-</div>
                        <div class="leads-kpi-label">Fallidos</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill fallidos" id="kpi-bar-fallidos"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-conversion">
                    <div class="leads-kpi-icon">üìà</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-conversion">-</div>
                        <div class="leads-kpi-label">Tasa Conversi√≥n</div>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Empresa</th>
                            <th>Sector</th>
                            <th>Tel√©fono</th>
                            <th>Email</th>
                            <th>Estado</th>
                            <th>Pr√≥xima Llamada</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="leads-master-table">
                        <tr>
                            <td colspan="7" class="loading">Cargando lista de leads...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab 3: Bulk Scheduler View -->
        <div id="view-scheduler" class="view-content">
            <div class="scheduler-container">
                <div class="scheduler-config glass-effect">
                    <div class="section-title" style="margin-bottom: 20px;">‚öôÔ∏è Configuraci√≥n de Programaci√≥n</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="sched-count">üìä Cantidad de Leads</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="number" id="sched-count" value="50" min="1" max="1000"
                                    style="flex:1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                                <select id="sched-source" class="filter-select"
                                    style="flex:1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                                    <option value="newest">M√°s recientes</option>
                                    <option value="oldest">M√°s antiguos</option>
                                </select>
                            </div>
                            <div
                                style="display: flex; align-items: center; gap: 10px; margin-top: 12px; background: rgba(99,102,241,0.08); padding: 12px 16px; border-radius: 10px; border: 1px solid rgba(99,102,241,0.2);">
                                <input type="checkbox" id="sched-skip-called" checked
                                    style="width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent);">
                                <label for="sched-skip-called"
                                    style="cursor: pointer; font-size: 13px; font-weight: 600; color: var(--text-primary); margin: 0;">
                                    üö´ Saltar leads ya llamados
                                </label>
                                <span style="font-size: 11px; color: var(--text-secondary); margin-left: auto;">Excluye:
                                    Completado, Contestador, No contesta, Fallido</span>
                            </div>
                            <p style="font-size: 11px; color: var(--text-secondary); margin-top: 6px;">Solo se
                                programar√°n leads con tel√©fono v√°lido y sin llamada pendiente</p>
                        </div>
                        <div class="form-group">
                            <label for="sched-start">üïê Fecha y Hora de Inicio</label>
                            <input type="datetime-local" id="sched-start"
                                style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                            <p style="font-size: 11px; color: var(--text-secondary); margin-top: 6px;">Primera llamada
                                se ejecutar√° a esta hora</p>
                        </div>
                        <div class="form-group">
                            <label for="sched-spacing">‚è±Ô∏è Espacio entre llamadas</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="number" id="sched-spacing" value="2" min="1" max="60"
                                    style="flex:1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                                <span
                                    style="color: var(--text-secondary); font-size: 14px; white-space: nowrap;">minutos</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="sched-assistant">ü§ñ Asistente IA</label>
                            <select id="sched-assistant" class="filter-select"
                                style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                                <option value="49e56db1-1f20-4cf1-b031-9cea9fba73cb">V1 ‚Äî Violeta (original)</option>
                                <option value="f34469b5-334e-4fbf-b5ad-b2b05e8d76ee">V2 ‚Äî Marcos (amable)</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button id="sched-preview-btn" class="refresh-btn" style="flex: 1;">üîç Ver Preview</button>
                        <button id="sched-execute-btn" class="refresh-btn"
                            style="flex: 1; background: var(--success); border-color: var(--success);" disabled>üöÄ
                            Programar Llamadas</button>
                    </div>
                </div>

                <!-- Schedule Summary -->
                <div id="sched-summary" class="scheduler-summary glass-effect" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div class="section-title" style="margin: 0;">üìã Resumen de Programaci√≥n</div>
                        <div id="sched-summary-stats" style="display: flex; gap: 16px;"></div>
                    </div>
                    <div id="sched-timeline" style="max-height: 400px; overflow-y: auto; padding-right: 8px;"></div>
                </div>

                <!-- Progress Bar -->
                <div id="sched-progress" class="scheduler-progress glass-effect" style="display: none;">
                    <div class="section-title" style="margin-bottom: 12px;">‚è≥ Progreso</div>
                    <div class="progress-bar-container">
                        <div id="sched-progress-bar" class="progress-bar-fill"></div>
                    </div>
                    <div id="sched-progress-text"
                        style="text-align: center; margin-top: 8px; font-size: 13px; color: var(--text-secondary);">0 /
                        0</div>
                    <div id="sched-progress-log"
                        style="max-height: 200px; overflow-y: auto; margin-top: 12px; font-family: monospace; font-size: 12px; color: var(--text-secondary);">
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 5: Realtime Monitor View -->
        <div id="view-realtime" class="view-content">
            <div class="realtime-header">
                <div class="realtime-header-info">
                    <h2 style="margin: 0; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                        <span class="live-pulse-dot"></span> Monitor en Tiempo Real
                    </h2>
                    <p style="color: var(--text-secondary); font-size: 13px; margin-top: 4px;">Visualiza las llamadas
                        activas y su transcripci√≥n en vivo.</p>
                </div>
                <div class="realtime-controls">
                    <div class="realtime-status-pill" id="realtime-status">
                        <span class="live-pulse-dot small"></span>
                        <span id="realtime-status-text">Escaneando...</span>
                    </div>
                    <button class="refresh-btn" id="realtime-refresh-btn" style="padding: 8px 16px;">üîÑ Forzar
                        Scan</button>
                </div>
            </div>

            <!-- Active Calls Counter -->
            <div class="realtime-stats" id="realtime-stats">
                <div class="realtime-stat-card">
                    <div class="realtime-stat-value" id="rt-active-count">0</div>
                    <div class="realtime-stat-label">Llamadas Activas</div>
                </div>
                <div class="realtime-stat-card">
                    <div class="realtime-stat-value" id="rt-queued-count">0</div>
                    <div class="realtime-stat-label">En Cola</div>
                </div>
                <div class="realtime-stat-card">
                    <div class="realtime-stat-value" id="rt-ringing-count">0</div>
                    <div class="realtime-stat-label">Sonando</div>
                </div>
                <div class="realtime-stat-card">
                    <div class="realtime-stat-value" id="rt-total-today">0</div>
                    <div class="realtime-stat-label">Total Hoy</div>
                </div>
            </div>

            <!-- Active Calls Grid -->
            <div id="realtime-calls-grid" class="realtime-calls-grid">
                <div class="realtime-empty-state">
                    <div class="realtime-empty-icon">üì°</div>
                    <h3>Escaneando llamadas activas...</h3>
                    <p>El sistema busca llamadas en curso autom√°ticamente cada 5 segundos.</p>
                </div>
            </div>
        </div>

        <!-- Tab 6: Test Calls View -->
        <div id="view-test" class="view-content">
            <div class="test-header">
                <div class="test-header-info">
                    <h2 style="margin: 0; font-size: 20px;">üß™ Llamadas de Test / Manuales</h2>
                    <p style="color: var(--text-secondary); font-size: 13px; margin-top: 4px;">Estas llamadas fueron
                        realizadas manualmente y no forman parte de las campa√±as programadas.</p>
                </div>
                <div class="test-stats" id="test-stats">
                    <div class="test-stat-pill">
                        <span class="test-stat-value" id="test-total">0</span>
                        <span class="test-stat-label">Total</span>
                    </div>
                    <div class="test-stat-pill success">
                        <span class="test-stat-value" id="test-success">0</span>
                        <span class="test-stat-label">Exitosas</span>
                    </div>
                    <div class="test-stat-pill danger">
                        <span class="test-stat-value" id="test-failed">0</span>
                        <span class="test-stat-label">Fallidas</span>
                    </div>
                    <div class="test-stat-pill warning">
                        <span class="test-stat-value" id="test-voicemail">0</span>
                        <span class="test-stat-label">Contestador</span>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Vapi Call ID</th>
                            <th>Empresa</th>
                            <th>Tel√©fono</th>
                            <th>Fecha</th>
                            <th>Resultado</th>
                            <th>Evaluaci√≥n</th>
                            <th>Duraci√≥n</th>
                            <th>Score</th>
                            <th>Confirmado</th>
                            <th>Detalle</th>
                        </tr>
                    </thead>
                    <tbody id="test-call-table">
                        <tr>
                            <td colspan="10" class="loading">Cargando llamadas de test...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal para Detalle -->
    <div class="modal" id="detail-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-modal">√ó</button>
            <div class="modal-header">
                <h2 id="modal-title">Detalle de la Llamada</h2>
                <p id="modal-subtitle" style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;"></p>
                <div id="modal-test-toggle"
                    style="margin-top: 12px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <button id="toggle-test-btn" class="toggle-test-pill" onclick="window._toggleDetailTest()">
                        <span class="toggle-test-icon">üß™</span>
                        <span class="toggle-test-label">Marcar como Test</span>
                    </button>
                    <button id="retry-call-btn" class="toggle-test-pill" onclick="window._retryCall()"
                        style="background: rgba(34, 197, 94, 0.15); border-color: rgba(34, 197, 94, 0.3);">
                        <span class="toggle-test-icon">üîÑ</span>
                        <span class="toggle-test-label">Rellamar con contexto</span>
                    </button>
                </div>
                <div id="retry-feedback" style="margin-top: 8px; font-size: 12px; display: none;"></div>
            </div>

            <div id="score-section" style="display: none; margin-bottom: 24px;"></div>

            <div class="section-title">üìù Transscripci√≥n</div>
            <div class="transcript-text" id="modal-transcript">No hay transcripci√≥n disponible para esta llamada.</div>
            <div id="extraction-tools" style="margin: 15px 0; display: none;">
                <button id="extract-transcript-btn" class="refresh-btn"
                    style="background: var(--accent); width: 100%;">‚ú® Extraer Info de Contacto</button>
            </div>

            <div id="extraction-results"
                style="display: none; background: rgba(99, 102, 241, 0.1); padding: 16px; border-radius: 12px; border: 1px solid var(--accent); margin-bottom: 24px;">
                <div class="section-title" style="margin-bottom: 12px; font-size: 14px; color: var(--accent);">üìã
                    Informaci√≥n Detectada</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="form-group">
                        <label style="font-size: 11px; margin-bottom: 4px;">Nombre</label>
                        <input type="text" id="ext-name"
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 8px; border-radius: 6px; color: white; font-size: 13px;">
                    </div>
                    <div class="form-group">
                        <label style="font-size: 11px; margin-bottom: 4px;">Tel√©fono</label>
                        <input type="text" id="ext-phone"
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 8px; border-radius: 6px; color: white; font-size: 13px;">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label style="font-size: 11px; margin-bottom: 4px;">Email</label>
                        <input type="text" id="ext-email"
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 8px; border-radius: 6px; color: white; font-size: 13px;">
                    </div>
                </div>
                <button id="apply-extraction-btn" class="refresh-btn"
                    style="width: 100%; margin-top: 15px; background: var(--success); border-color: var(--success);">üíæ
                    Actualizar Lead Relacionado</button>
                <p id="extraction-feedback" style="font-size: 11px; text-align: center; margin-top: 8px;"></p>
            </div>

            <div id="recording-section" style="display: none;">
                <div class="section-title">üîä Grabaci√≥n</div>
                <audio id="modal-audio" class="audio-player" controls>
                    Tu navegador no soporta el elemento de audio.
                </audio>
            </div>

            <div id="error-section"
                style="display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                <div class="section-title" style="color: var(--danger); margin-bottom: 8px;">‚ùå Error en la Llamada</div>
                <div id="modal-error-detail" style="color: var(--text-primary); font-size: 14px; line-height: 1.5;">
                </div>
            </div>

            <div id="confirmed-section"
                style="display: none; background: rgba(245, 158, 11, 0.1); padding: 16px; border-radius: 12px; border: 1px solid var(--warning); margin-bottom: 24px;">
                <div class="section-title" style="margin-bottom: 8px;">‚úÖ Datos Confirmados</div>
                <div style="font-size: 14px;">
                    <p><strong>Nombre:</strong> <span id="conf-name"></span></p>
                    <p><strong>Tel√©fono:</strong> <span id="conf-phone"></span></p>
                    <p><strong>Email:</strong> <span id="conf-email"></span></p>
                </div>
            </div>
            <div class="section-title">üìù Notas del Agente</div>

            <textarea id="modal-notes" class="notes-area"
                placeholder="Escribe aqu√≠ tus observaciones sobre la llamada..."></textarea>
            <button id="save-notes-btn" class="refresh-btn" style="width: 100%; margin-top: 10px;">üíæ Guardar
                Notas</button>
        </div>
    </div>

    <!-- Floating Action Button for Manual Call -->
    <button id="manual-call-fab" class="fab" title="Nueva Llamada Manual">
        <span>üìû</span>
    </button>

    <!-- Modal for Manual Call -->
    <div class="modal" id="manual-call-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-manual-modal">√ó</button>
            <div class="modal-header">
                <h2>üìû Nueva Llamada Manual</h2>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">Introduce los datos del
                    cliente para forzar la llamada</p>
            </div>

            <div class="form-group">
                <label for="manual-lead-name">Nombre del Cliente</label>
                <input type="text" id="manual-lead-name" placeholder="Ej: Juan P√©rez" required>
            </div>

            <div class="form-group">
                <label for="manual-company">Empresa / Nombre Comercial</label>
                <input type="text" id="manual-company" placeholder="Ej: Talleres P√©rez" required>
            </div>

            <div class="form-group">
                <label for="manual-assistant">Asistente IA</label>
                <select id="manual-assistant" class="filter-select"
                    style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                    <option value="49e56db1-1f20-4cf1-b031-9cea9fba73cb">V1 ‚Äî Violeta (original)</option>
                    <option value="f34469b5-334e-4fbf-b5ad-b2b05e8d76ee">V2 ‚Äî Marcos (amable)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="manual-phone">Tel√©fono</label>
                <input type="tel" id="manual-phone" placeholder="Ej: 600123456" required>
            </div>

            <div class="form-group"
                style="background: rgba(255,255,255,0.03); padding: 16px; border-radius: 12px; border: 1px dashed var(--border);">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <input type="checkbox" id="manual-schedule-toggle"
                        style="width: 18px; height: 18px; cursor: pointer;">
                    <label for="manual-schedule-toggle"
                        style="margin-bottom: 0; cursor: pointer; font-weight: 600; color: var(--text-primary);">üìÖ
                        Programar para m√°s tarde</label>
                </div>
                <div id="manual-schedule-fields" style="display: none;">
                    <input type="datetime-local" id="manual-schedule-time"
                        style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 12px; border-radius: 8px; color: white; font-size: 14px;">
                    <p style="font-size: 11px; color: var(--text-secondary); margin-top: 8px;">La llamada se lanzar√°
                        autom√°ticamente a la hora elegida (¬±1 min).</p>
                </div>
            </div>

            <button id="trigger-call-btn" class="refresh-btn"
                style="width: 100%; margin-top: 20px; background: var(--success); border-color: var(--success);">
                üöÄ Lanzar Llamada
            </button>

            <div id="call-feedback" style="margin-top: 15px; text-align: center; font-weight: 500; min-height: 24px;">
            </div>
        </div>
    </div>

    <!-- Lead Editor Modal -->
    <div id="lead-modal" class="modal">
        <div class="modal-content glass-effect">
            <button class="close-modal" id="close-lead-modal">√ó</button>
            <div class="modal-header">
                <h2 id="lead-modal-title">‚ú® Gesti√≥n de Lead</h2>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">Edita o a√±ade informaci√≥n del
                    lead</p>
            </div>
            <form id="lead-form">
                <input type="hidden" id="edit-lead-id">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                    <div class="form-group">
                        <label for="edit-lead-name">Empresa</label>
                        <input type="text" id="edit-lead-name" required placeholder="Nombre de la empresa">
                    </div>
                    <div class="form-group">
                        <label for="edit-lead-phone">Tel√©fono</label>
                        <input type="text" id="edit-lead-phone" required placeholder="+34...">
                    </div>
                    <div class="form-group">
                        <label for="edit-lead-email">Email</label>
                        <input type="email" id="edit-lead-email" placeholder="correo@empresa.com">
                    </div>
                    <div class="form-group">
                        <label for="edit-lead-sector">Sector</label>
                        <input type="text" id="edit-lead-sector" placeholder="Ej: Construcci√≥n">
                    </div>
                    <div class="form-group">
                        <label for="edit-lead-status">Estado</label>
                        <select id="edit-lead-status" class="filter-select"
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                            <option value="Nuevo">Nuevo</option>
                            <option value="Programado">Programado</option>
                            <option value="Interesado">Interesado</option>
                            <option value="Completado">Completado</option>
                            <option value="Contestador">üìû Contestador</option>
                            <option value="Reintentar">Reintentar</option>
                            <option value="Fallido">Fallido</option>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label for="edit-lead-summary">Resumen / Notas IA</label>
                        <textarea id="edit-lead-summary" placeholder="Resumen de la empresa o notas de la IA..."
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px; min-height: 80px;"></textarea>
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label for="edit-lead-address">Direcci√≥n / URL</label>
                        <input type="text" id="edit-lead-address" placeholder="Direcci√≥n f√≠sica o URL del sitio">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label for="edit-lead-planned">üìÖ Programar Llamada</label>
                        <input type="datetime-local" id="edit-lead-planned"
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                    </div>
                </div>
                <div style="margin-top: 24px; display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" class="refresh-btn" style="background: var(--border); border: none;"
                        id="cancel-lead-save">Cancelar</button>
                    <button type="submit" class="refresh-btn" id="save-lead-btn">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="dashboard-footer">
        <div class="footer-left">
            <span>&copy; 2026 SkyPulse - GeneralProtect</span>
            <span class="footer-separator">|</span>
            <span id="system-status"><span class="status-dot"></span> Sistema Activo</span>
        </div>
        <div class="footer-right">
            <span class="icon">üìç</span>
            <span id="local-time-label" style="font-size: 11px; color: var(--text-secondary); margin-right: 5px;">Hora
                Local (Espa√±a):</span>
            <span id="live-clock" class="live-clock">--:--:--</span>
        </div>
    </footer>

    <script type="module" src="./main.js"></script>
</body>

</html>