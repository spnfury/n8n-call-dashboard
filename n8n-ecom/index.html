<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcomPulse ‚Äî Confirmaci√≥n de Pedidos IA</title>
    <meta name="description"
        content="Dashboard inteligente para confirmaci√≥n de pedidos ecommerce mediante llamadas de IA">
    <link rel="stylesheet" href="./style.css">
    <!-- Extra Dependencies -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>

<body class="auth-hidden">
    <!-- Login Gate -->
    <div id="login-gate" class="login-overlay">
        <div class="login-card">
            <div class="brand-icon">üõí</div>
            <h2>EcomPulse</h2>
            <p>Introduce la contrase√±a para acceder</p>
            <form id="login-form">
                <input type="password" id="password-input" placeholder="Contrase√±a" required>
                <button type="submit" class="refresh-btn" style="width: 100%;">Entrar</button>
            </form>
            <p id="auth-error" class="auth-error" style="display: none;">Contrase√±a incorrecta</p>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="container" id="main-content">
        <header>
            <h1>
                <span class="header-icon">üõí</span>
                EcomPulse <small
                    style="font-size: 12px; color: var(--text-secondary); margin-left: 8px; font-weight: 400;">v0.1.0</small>
            </h1>
            <div class="header-actions">
                <div class="automation-control">
                    <span style="font-size: 13px; font-weight: 600;">ü§ñ Auto-confirm</span>
                    <label class="switch">
                        <input type="checkbox" id="automation-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <button class="refresh-btn" id="refresh-btn">üîÑ Actualizar</button>
            </div>
        </header>

        <nav class="nav-tabs">
            <div class="nav-tab active" data-tab="dashboard">üìä Dashboard</div>
            <div class="nav-tab" data-tab="orders">üì¶ Pedidos</div>
            <div class="nav-tab" data-tab="scheduler">üìÖ Programar Llamadas</div>
            <div class="nav-tab" data-tab="realtime" id="nav-tab-realtime">üî¥ En Vivo <span id="realtime-badge"
                    class="realtime-badge" style="display:none;">0</span></div>
            <div class="nav-tab" data-tab="test">üß™ Test</div>
        </nav>

        <!-- Tab 1: Dashboard View -->
        <div id="view-dashboard" class="view-content active">

            <!-- Integrated Filter Bar -->
            <div class="dashboard-filter-bar">
                <div class="filter-bar-search">
                    <span class="filter-bar-icon">üîç</span>
                    <input type="text" id="filter-company" placeholder="Buscar por cliente o n¬∫ pedido...">
                </div>
                <div class="filter-bar-controls">
                    <div class="filter-pill">
                        <span class="filter-pill-icon">üö¶</span>
                        <select id="filter-status" class="filter-pill-select">
                            <option value="all">Todos</option>
                            <option value="confirmed">Confirmados</option>
                            <option value="modified">Modificados</option>
                            <option value="cancelled">Cancelados</option>
                            <option value="unreachable">No Contactados</option>
                        </select>
                    </div>
                    <div class="filter-pill">
                        <span class="filter-pill-icon">üí∞</span>
                        <select id="filter-score" class="filter-pill-select">
                            <option value="all">Importe</option>
                            <option value="200+">üü¢ 200‚Ç¨+</option>
                            <option value="100-199">üîµ 100-199‚Ç¨</option>
                            <option value="50-99">üü° 50-99‚Ç¨</option>
                            <option value="0-49">üü† 0-49‚Ç¨</option>
                        </select>
                    </div>
                    <div class="filter-pill date-pill">
                        <span class="filter-pill-icon">üìÖ</span>
                        <input type="text" id="date-range" placeholder="Fechas...">
                    </div>
                    <label class="filter-pill filter-pill-toggle" for="filter-confirmed">
                        <input type="checkbox" id="filter-confirmed">
                        <span class="filter-pill-check">‚úÖ Confirmados</span>
                    </label>
                </div>
            </div>

            <div class="analytics-section">
                <div class="section-title">üìä Rendimiento de Confirmaciones</div>
                <div class="chart-container glass-effect">
                    <canvas id="callsChart"></canvas>
                </div>
            </div>

            <div class="stats-grid" id="stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-calls">-</div>
                    <div class="stat-label">Total Llamadas</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value" id="confirmed-count">0</div>
                    <div class="stat-label">Pedidos Confirmados</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-value" id="modified-count">0</div>
                    <div class="stat-label">Pedidos Modificados</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-value" id="cancelled-count">0</div>
                    <div class="stat-label">Cancelados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="confirmation-rate">0%</div>
                    <div class="stat-label">Tasa Confirmaci√≥n</div>
                </div>
                <div class="stat-card score">
                    <div class="stat-value" id="avg-order-value">-</div>
                    <div class="stat-label">Ticket Medio</div>
                </div>
            </div>

            <div class="section-title">üìã Historial de Llamadas</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Call ID</th>
                            <th>Cliente</th>
                            <th>N¬∫ Pedido</th>
                            <th>Tel√©fono</th>
                            <th>Fecha</th>
                            <th>Resultado</th>
                            <th>Duraci√≥n</th>
                            <th>Importe</th>
                            <th>Estado Pedido</th>
                            <th>Detalle</th>
                        </tr>
                    </thead>
                    <tbody id="call-table">
                        <tr>
                            <td colspan="10" class="loading">Cargando datos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab 2: Orders Management View -->
        <div id="view-orders" class="view-content">
            <div class="leads-header">
                <div class="leads-search-container">
                    <input type="text" id="order-search" class="leads-search-input"
                        placeholder="Buscar pedidos por cliente, n¬∫ pedido, tel√©fono o producto...">
                </div>
                <div class="leads-actions">
                    <input type="file" id="csv-import" accept=".csv" style="display: none;">
                    <button class="btn-bulk-import" id="btn-import-csv">üìÇ Importar CSV</button>
                    <button class="btn-add-lead" id="btn-add-order">‚ú® Nuevo Pedido</button>
                </div>
            </div>

            <!-- KPI Header -->
            <div class="leads-kpi-section">
                <div class="leads-kpi-card leads-kpi-total">
                    <div class="leads-kpi-icon">üì¶</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-total-orders">-</div>
                        <div class="leads-kpi-label">Total Pedidos</div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-nuevos">
                    <div class="leads-kpi-icon">üÜï</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-pendientes">-</div>
                        <div class="leads-kpi-label">Pendientes</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill nuevos" id="kpi-bar-pendientes"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-programados">
                    <div class="leads-kpi-icon">üìû</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-llamando">-</div>
                        <div class="leads-kpi-label">En Llamada</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill programados" id="kpi-bar-llamando"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-completados">
                    <div class="leads-kpi-icon">‚úÖ</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-confirmados">-</div>
                        <div class="leads-kpi-label">Confirmados</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill completados" id="kpi-bar-confirmados"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-interesados">
                    <div class="leads-kpi-icon">‚úèÔ∏è</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-modificados">-</div>
                        <div class="leads-kpi-label">Modificados</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill interesados" id="kpi-bar-modificados"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-fallidos">
                    <div class="leads-kpi-icon">‚ùå</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-cancelados">-</div>
                        <div class="leads-kpi-label">Cancelados</div>
                    </div>
                    <div class="leads-kpi-bar">
                        <div class="leads-kpi-bar-fill fallidos" id="kpi-bar-cancelados"></div>
                    </div>
                </div>
                <div class="leads-kpi-card leads-kpi-conversion">
                    <div class="leads-kpi-icon">üìà</div>
                    <div class="leads-kpi-info">
                        <div class="leads-kpi-value" id="kpi-conversion">-</div>
                        <div class="leads-kpi-label">Tasa Confirmaci√≥n</div>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>N¬∫ Pedido</th>
                            <th>Cliente</th>
                            <th>Tel√©fono</th>
                            <th>Productos</th>
                            <th>Total</th>
                            <th>Direcci√≥n</th>
                            <th>Estado</th>
                            <th>Pr√≥x. Llamada</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="orders-master-table">
                        <tr>
                            <td colspan="9" class="loading">Cargando pedidos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab 3: Bulk Scheduler View -->
        <div id="view-scheduler" class="view-content">
            <div class="scheduler-container">
                <div class="scheduler-config glass-effect">
                    <div class="section-title" style="margin-bottom: 20px;">‚öôÔ∏è Configurar Lote de Confirmaciones</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="sched-count">üìä Cantidad de Pedidos</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="number" id="sched-count" value="50" min="1" max="1000"
                                    style="flex:1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                                <select id="sched-source" class="filter-select"
                                    style="flex:1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                                    <option value="newest">M√°s recientes</option>
                                    <option value="oldest">M√°s antiguos</option>
                                    <option value="highest">Mayor importe</option>
                                </select>
                            </div>
                            <div
                                style="display: flex; align-items: center; gap: 10px; margin-top: 12px; background: rgba(16,185,129,0.08); padding: 12px 16px; border-radius: 10px; border: 1px solid rgba(16,185,129,0.2);">
                                <input type="checkbox" id="sched-skip-called" checked
                                    style="width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent);">
                                <label for="sched-skip-called"
                                    style="cursor: pointer; font-size: 13px; font-weight: 600; color: var(--text-primary); margin: 0;">
                                    üö´ Saltar ya contactados
                                </label>
                                <span style="font-size: 11px; color: var(--text-secondary); margin-left: auto;">Excluye:
                                    Confirmado, Cancelado, No contesta</span>
                            </div>
                            <p style="font-size: 11px; color: var(--text-secondary); margin-top: 6px;">Solo se
                                programar√°n pedidos pendientes con tel√©fono v√°lido</p>
                        </div>
                        <div class="form-group">
                            <label for="sched-start">üïê Fecha y Hora de Inicio</label>
                            <input type="datetime-local" id="sched-start"
                                style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                            <p style="font-size: 11px; color: var(--text-secondary); margin-top: 6px;">Primera llamada
                                se ejecutar√° a esta hora</p>
                        </div>
                        <div class="form-group">
                            <label for="sched-spacing">‚è±Ô∏è Espacio entre llamadas</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="number" id="sched-spacing" value="2" min="1" max="60"
                                    style="flex:1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                                <span
                                    style="color: var(--text-secondary); font-size: 14px; white-space: nowrap;">minutos</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="sched-assistant">ü§ñ Asistente IA</label>
                            <select id="sched-assistant" class="filter-select"
                                style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                                <option value="ecom-confirm-v1">V1 ‚Äî Confirmador Est√°ndar</option>
                                <option value="ecom-confirm-v2">V2 ‚Äî Confirmador Amable</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button id="sched-preview-btn" class="refresh-btn" style="flex: 1;">üîç Ver Preview</button>
                        <button id="sched-execute-btn" class="refresh-btn"
                            style="flex: 1; background: var(--success); border-color: var(--success);" disabled>üöÄ
                            Lanzar Confirmaciones</button>
                    </div>
                </div>

                <!-- Schedule Summary -->
                <div id="sched-summary" class="scheduler-summary glass-effect" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div class="section-title" style="margin: 0;">üìã Resumen del Lote</div>
                        <div id="sched-summary-stats" style="display: flex; gap: 16px;"></div>
                    </div>
                    <div id="sched-timeline" style="max-height: 400px; overflow-y: auto; padding-right: 8px;"></div>
                </div>

                <!-- Progress Bar -->
                <div id="sched-progress" class="scheduler-progress glass-effect" style="display: none;">
                    <div class="section-title" style="margin-bottom: 12px;">‚è≥ Progreso</div>
                    <div class="progress-bar-container">
                        <div id="sched-progress-bar" class="progress-bar-fill"></div>
                    </div>
                    <div id="sched-progress-text"
                        style="text-align: center; margin-top: 8px; font-size: 13px; color: var(--text-secondary);">0 /
                        0</div>
                    <div id="sched-progress-log"
                        style="max-height: 200px; overflow-y: auto; margin-top: 12px; font-family: monospace; font-size: 12px; color: var(--text-secondary);">
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 4: Realtime Monitor View -->
        <div id="view-realtime" class="view-content">
            <div class="realtime-header">
                <div class="realtime-header-info">
                    <h2 style="margin: 0; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                        <span class="live-pulse-dot"></span> Monitor en Tiempo Real
                    </h2>
                    <p style="color: var(--text-secondary); font-size: 13px; margin-top: 4px;">Confirmaciones de
                        pedidos en curso</p>
                </div>
                <div class="realtime-controls">
                    <div class="realtime-status-pill" id="realtime-status">
                        <span class="live-pulse-dot small"></span>
                        <span id="realtime-status-text">Escaneando...</span>
                    </div>
                    <button class="refresh-btn" id="realtime-refresh-btn" style="padding: 8px 16px;">üîÑ Forzar
                        Scan</button>
                </div>
            </div>

            <!-- Active Calls Counter -->
            <div class="realtime-stats" id="realtime-stats">
                <div class="realtime-stat-card">
                    <div class="realtime-stat-value" id="rt-active-count">0</div>
                    <div class="realtime-stat-label">Llamadas Activas</div>
                </div>
                <div class="realtime-stat-card">
                    <div class="realtime-stat-value" id="rt-queued-count">0</div>
                    <div class="realtime-stat-label">En Cola</div>
                </div>
                <div class="realtime-stat-card">
                    <div class="realtime-stat-value" id="rt-ringing-count">0</div>
                    <div class="realtime-stat-label">Sonando</div>
                </div>
                <div class="realtime-stat-card">
                    <div class="realtime-stat-value" id="rt-total-today">0</div>
                    <div class="realtime-stat-label">Total Hoy</div>
                </div>
            </div>

            <!-- Active Calls Grid -->
            <div id="realtime-calls-grid" class="realtime-calls-grid">
                <div class="realtime-empty-state">
                    <div class="realtime-empty-icon">üì°</div>
                    <h3>Escaneando llamadas activas...</h3>
                    <p>El sistema busca llamadas en curso autom√°ticamente cada 5 segundos.</p>
                </div>
            </div>
        </div>

        <!-- Tab 5: Test Calls View -->
        <div id="view-test" class="view-content">
            <div class="test-header">
                <div class="test-header-info">
                    <h2 style="margin: 0; font-size: 20px;">üß™ Llamadas de Test</h2>
                    <p style="color: var(--text-secondary); font-size: 13px; margin-top: 4px;">Llamadas de prueba para
                        validar el asistente de confirmaci√≥n.</p>
                </div>
                <div class="test-stats" id="test-stats">
                    <div class="test-stat-pill">
                        <span class="test-stat-value" id="test-total">0</span>
                        <span class="test-stat-label">Total</span>
                    </div>
                    <div class="test-stat-pill success">
                        <span class="test-stat-value" id="test-success">0</span>
                        <span class="test-stat-label">Confirmadas</span>
                    </div>
                    <div class="test-stat-pill danger">
                        <span class="test-stat-value" id="test-failed">0</span>
                        <span class="test-stat-label">Fallidas</span>
                    </div>
                    <div class="test-stat-pill warning">
                        <span class="test-stat-value" id="test-voicemail">0</span>
                        <span class="test-stat-label">Contestador</span>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Call ID</th>
                            <th>Cliente</th>
                            <th>N¬∫ Pedido</th>
                            <th>Tel√©fono</th>
                            <th>Fecha</th>
                            <th>Resultado</th>
                            <th>Duraci√≥n</th>
                            <th>Estado Pedido</th>
                            <th>Detalle</th>
                        </tr>
                    </thead>
                    <tbody id="test-call-table">
                        <tr>
                            <td colspan="9" class="loading">Cargando llamadas de test...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal para Detalle de Llamada -->
    <div class="modal" id="detail-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-modal">√ó</button>
            <div class="modal-header">
                <h2 id="modal-title">Detalle de Confirmaci√≥n</h2>
                <p id="modal-subtitle" style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;"></p>
                <div id="modal-test-toggle"
                    style="margin-top: 12px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <button id="toggle-test-btn" class="toggle-test-pill" onclick="window._toggleDetailTest()">
                        <span class="toggle-test-icon">üß™</span>
                        <span class="toggle-test-label">Marcar como Test</span>
                    </button>
                    <button id="retry-call-btn" class="toggle-test-pill" onclick="window._retryCall()"
                        style="background: rgba(34, 197, 94, 0.15); border-color: rgba(34, 197, 94, 0.3);">
                        <span class="toggle-test-icon">üîÑ</span>
                        <span class="toggle-test-label">Rellamar</span>
                    </button>
                </div>
                <div id="retry-feedback" style="margin-top: 8px; font-size: 12px; display: none;"></div>
            </div>

            <!-- Order Info Section -->
            <div id="order-info-section"
                style="display: none; background: rgba(16, 185, 129, 0.08); padding: 16px; border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.2); margin-bottom: 24px;">
                <div class="section-title" style="margin-bottom: 12px; font-size: 14px; color: var(--accent-ecom);">üì¶
                    Datos del Pedido</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                    <p><strong>N¬∫ Pedido:</strong> <span id="order-number">‚Äî</span></p>
                    <p><strong>Total:</strong> <span id="order-total">‚Äî</span></p>
                    <p><strong>Productos:</strong> <span id="order-products">‚Äî</span></p>
                    <p><strong>Direcci√≥n:</strong> <span id="order-address">‚Äî</span></p>
                </div>
            </div>

            <!-- Confirmed Data Section -->
            <div id="confirmed-section"
                style="display: none; background: rgba(245, 158, 11, 0.1); padding: 16px; border-radius: 12px; border: 1px solid var(--warning); margin-bottom: 24px;">
                <div class="section-title" style="margin-bottom: 8px;">‚úÖ Datos Confirmados por el Cliente</div>
                <div style="font-size: 14px;">
                    <p><strong>Nombre:</strong> <span id="conf-name"></span></p>
                    <p><strong>Direcci√≥n:</strong> <span id="conf-address"></span></p>
                    <p><strong>Tel√©fono:</strong> <span id="conf-phone"></span></p>
                    <p><strong>Productos OK:</strong> <span id="conf-products"></span></p>
                    <p><strong>Modificaciones:</strong> <span id="conf-modifications"></span></p>
                </div>
            </div>

            <div class="section-title">üìù Transcripci√≥n</div>
            <div class="transcript-text" id="modal-transcript">No hay transcripci√≥n disponible para esta llamada.</div>

            <div id="recording-section" style="display: none;">
                <div class="section-title">üîä Grabaci√≥n</div>
                <audio id="modal-audio" class="audio-player" controls>
                    Tu navegador no soporta el elemento de audio.
                </audio>
            </div>

            <div id="error-section"
                style="display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                <div class="section-title" style="color: var(--danger); margin-bottom: 8px;">‚ùå Error en la Llamada</div>
                <div id="modal-error-detail" style="color: var(--text-primary); font-size: 14px; line-height: 1.5;">
                </div>
            </div>

            <div class="section-title">üìù Notas del Operador</div>
            <textarea id="modal-notes" class="notes-area"
                placeholder="Escribe aqu√≠ tus observaciones sobre la confirmaci√≥n..."></textarea>
            <button id="save-notes-btn" class="refresh-btn" style="width: 100%; margin-top: 10px;">üíæ Guardar
                Notas</button>
        </div>
    </div>

    <!-- Floating Action Button for Manual Call -->
    <button id="manual-call-fab" class="fab" title="Nueva Confirmaci√≥n Manual">
        <span>üìû</span>
    </button>

    <!-- Modal for Manual Call -->
    <div class="modal" id="manual-call-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-manual-modal">√ó</button>
            <div class="modal-header">
                <h2>üìû Nueva Confirmaci√≥n Manual</h2>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">Introduce los datos del
                    pedido para llamar al cliente</p>
            </div>

            <div class="form-group">
                <label for="manual-lead-name">Nombre del Cliente</label>
                <input type="text" id="manual-lead-name" placeholder="Ej: Mar√≠a Garc√≠a" required>
            </div>

            <div class="form-group">
                <label for="manual-order-number">N¬∫ Pedido</label>
                <input type="text" id="manual-order-number" placeholder="Ej: #ORD-2026-001234" required>
            </div>

            <div class="form-group">
                <label for="manual-order-total">Importe Total (‚Ç¨)</label>
                <input type="number" id="manual-order-total" placeholder="Ej: 89.90" step="0.01" min="0">
            </div>

            <div class="form-group">
                <label for="manual-order-products">Productos</label>
                <input type="text" id="manual-order-products" placeholder="Ej: 2x Camiseta Azul, 1x Pantal√≥n Negro">
            </div>

            <div class="form-group">
                <label for="manual-order-address">Direcci√≥n de Env√≠o</label>
                <input type="text" id="manual-order-address" placeholder="Ej: C/ Mayor 15, 28001 Madrid">
            </div>

            <div class="form-group">
                <label for="manual-assistant">Asistente IA</label>
                <select id="manual-assistant" class="filter-select"
                    style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                    <option value="ecom-confirm-v1">V1 ‚Äî Confirmador Est√°ndar</option>
                    <option value="ecom-confirm-v2">V2 ‚Äî Confirmador Amable</option>
                </select>
            </div>

            <div class="form-group">
                <label for="manual-phone">Tel√©fono del Cliente</label>
                <input type="tel" id="manual-phone" placeholder="Ej: 600123456" required>
            </div>

            <div class="form-group"
                style="background: rgba(255,255,255,0.03); padding: 16px; border-radius: 12px; border: 1px dashed var(--border);">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <input type="checkbox" id="manual-schedule-toggle"
                        style="width: 18px; height: 18px; cursor: pointer;">
                    <label for="manual-schedule-toggle"
                        style="margin-bottom: 0; cursor: pointer; font-weight: 600; color: var(--text-primary);">üìÖ
                        Programar para m√°s tarde</label>
                </div>
                <div id="manual-schedule-fields" style="display: none;">
                    <input type="datetime-local" id="manual-schedule-time"
                        style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 12px; border-radius: 8px; color: white; font-size: 14px;">
                    <p style="font-size: 11px; color: var(--text-secondary); margin-top: 8px;">La llamada se lanzar√°
                        autom√°ticamente a la hora elegida.</p>
                </div>
            </div>

            <button id="trigger-call-btn" class="refresh-btn"
                style="width: 100%; margin-top: 20px; background: var(--success); border-color: var(--success);">
                üöÄ Llamar para Confirmar
            </button>

            <div id="call-feedback" style="margin-top: 15px; text-align: center; font-weight: 500; min-height: 24px;">
            </div>
        </div>
    </div>

    <!-- Order Editor Modal -->
    <div id="order-modal" class="modal">
        <div class="modal-content glass-effect">
            <button class="close-modal" id="close-order-modal">√ó</button>
            <div class="modal-header">
                <h2 id="order-modal-title">üì¶ Gesti√≥n de Pedido</h2>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">Edita o a√±ade informaci√≥n del
                    pedido</p>
            </div>
            <form id="order-form">
                <input type="hidden" id="edit-order-id">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                    <div class="form-group">
                        <label for="edit-order-number">N¬∫ Pedido</label>
                        <input type="text" id="edit-order-number" required placeholder="#ORD-2026-...">
                    </div>
                    <div class="form-group">
                        <label for="edit-customer-name">Cliente</label>
                        <input type="text" id="edit-customer-name" required placeholder="Nombre del cliente">
                    </div>
                    <div class="form-group">
                        <label for="edit-customer-phone">Tel√©fono</label>
                        <input type="text" id="edit-customer-phone" required placeholder="+34...">
                    </div>
                    <div class="form-group">
                        <label for="edit-customer-email">Email</label>
                        <input type="email" id="edit-customer-email" placeholder="correo@cliente.com">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label for="edit-order-products">Productos</label>
                        <textarea id="edit-order-products" placeholder="Describe los productos del pedido..."
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px; min-height: 60px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-order-total">Total (‚Ç¨)</label>
                        <input type="number" id="edit-order-total" step="0.01" min="0" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="edit-order-status">Estado</label>
                        <select id="edit-order-status" class="filter-select"
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                            <option value="Pendiente">üì¶ Pendiente</option>
                            <option value="Programado">üìÖ Programado</option>
                            <option value="Confirmado">‚úÖ Confirmado</option>
                            <option value="Modificado">‚úèÔ∏è Modificado</option>
                            <option value="Cancelado">‚ùå Cancelado</option>
                            <option value="No contesta">üìµ No contesta</option>
                            <option value="Contestador">üìû Contestador</option>
                            <option value="Entregado">üöö Entregado</option>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label for="edit-order-address">Direcci√≥n de Env√≠o</label>
                        <input type="text" id="edit-order-address" placeholder="Calle, n√∫mero, CP, ciudad">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label for="edit-order-notes">Notas / Observaciones</label>
                        <textarea id="edit-order-notes" placeholder="Notas sobre el pedido o la llamada..."
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px; min-height: 60px;"></textarea>
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label for="edit-order-planned">üìÖ Programar Llamada</label>
                        <input type="datetime-local" id="edit-order-planned"
                            style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 14px 18px; border-radius: 12px; color: white; font-size: 15px;">
                    </div>
                </div>
                <div style="margin-top: 24px; display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" class="refresh-btn" style="background: var(--border); border: none;"
                        id="cancel-order-save">Cancelar</button>
                    <button type="submit" class="refresh-btn" id="save-order-btn">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="dashboard-footer">
        <div class="footer-left">
            <span>&copy; 2026 EcomPulse</span>
            <span class="footer-separator">|</span>
            <span id="system-status"><span class="status-dot"></span> Sistema Activo</span>
        </div>
        <div class="footer-right">
            <span class="icon">üìç</span>
            <span id="local-time-label" style="font-size: 11px; color: var(--text-secondary); margin-right: 5px;">Hora
                Local:</span>
            <span id="live-clock" class="live-clock">--:--:--</span>
        </div>
    </footer>

    <script type="module" src="./main.js"></script>
</body>

</html>